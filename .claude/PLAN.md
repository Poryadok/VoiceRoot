# Voice — Product Roadmap

Продуктовый роадмап. Детали проекта и видение — в [PROJECT.md](PROJECT.md).

## Текущее состояние кодовой базы

| Компонент | Статус |
|-----------|--------|
| VoiceAuthService | Работает (JWT, регистрация/вход, PostgreSQL) |
| VoiceWebSocketService | Инфраструктура есть, handler не реализован |
| VoiceChannelDataService | Пустой (только go.mod) |
| VoiceMessageService | Пустой (только go.mod) |
| Flutter client | P2P WebRTC через Firebase, не подключён к бэкенду |
| Proto-контракты | Полностью определены |

---

## Фаза 0 — Фундамент

**Цель:** Связать все части и принять ключевые технологические решения.

- [ ] Выбрать технологию голосового чата — **рекомендация: LiveKit** (open-source SFU на Go, self-hostable, есть Flutter SDK)
- [ ] Реализовать VoiceWebSocketService — заполнить `SendNotification` handler
- [ ] Реализовать VoiceChannelDataService — CRUD каналов и комнат (gRPC + PostgreSQL)
- [ ] Реализовать VoiceMessageService — отправка и получение текстовых сообщений
- [ ] Подключить Flutter к VoiceAuthService — убрать Firebase signaling, добавить JWT-логин

---

## Фаза 1 — MVP: Текстовый чат + каналы

**Цель:** Пользователи могут создавать каналы, писать сообщения, видеть историю.

**Бэкенд:**
- [ ] Регистрация / вход (Flutter → VoiceAuthService)
- [ ] Создание и список каналов и комнат
- [ ] Отправка и получение текстовых сообщений
- [ ] Real-time уведомления о новых сообщениях (WebSocket)

**Flutter UI:**
- [ ] Экран логина / регистрации
- [ ] Sidebar с каналами
- [ ] Экран комнаты с текстовым чатом

**Результат:** Работающий текстовый мессенджер для первых пользователей.

---

## Фаза 2 — Голосовой чат

**Цель:** Пользователи могут говорить в голосовых комнатах.

- [ ] Задеплоить LiveKit сервер (docker-compose)
- [ ] Создать VoiceMediaService — выдача токенов доступа к LiveKit комнатам
- [ ] Интеграция Flutter с LiveKit Flutter SDK
- [ ] PTT (Push-to-Talk) и открытый микрофон
- [ ] Отображение участников голосовой комнаты

**Результат:** Полноценный аналог Discord-комнаты (текст + голос). Функциональный MVP.

---

## Фаза 3 — Матчмейкинг

**Цель:** Уникальная фича — автоматический подбор по игре и критериям.

**Бэкенд:**
- [ ] Создать VoiceMatchmakingService (Go, gRPC)
- [ ] Каталог игр: Dota 2, CS2, Valorant, PUBG и др. (захардкожен на старте)
- [ ] Система критериев: роль, ранг, регион, количество слотов
- [ ] Очередь (in-memory на старте, потом Redis)
- [ ] Алгоритм матча по критериям
- [ ] Автосоздание временной комнаты (голос + текст) при матче
- [ ] Push-уведомление через WebSocket при найденном матче
- [ ] История матчей в профиле

**Flutter UI:**
- [ ] Экран матчмейкинга: выбор игры
- [ ] Экран критериев: роль, ранг и т.д.
- [ ] Экран поиска: "ищем напарников..."
- [ ] Уведомление о матче + переход в комнату

**Результат:** Работает ключевой дифференциатор продукта.

---

## Фаза 4 — Рост

Направление определяется по фидбеку после запуска.

**Геймерский трек:**
- [ ] ELO и история матчей
- [ ] Рейтинги в каналах
- [ ] Steam OpenID интеграция (верификация ранга)
- [ ] Мобильные клиенты (Android/iOS через Flutter)

**Корпоративный трек:**
- [ ] Self-hosting docker-compose образ
- [ ] Роли и права в каналах
- [ ] Монетизация: поддержка / SaaS-план

---

## Архитектурные решения

| Решение | Выбор | Почему |
|---------|-------|--------|
| Голосовой чат | LiveKit (SFU) | Open-source, Go, self-hostable, Flutter SDK, масштабируется |
| База данных | PostgreSQL | Уже используется в AuthService |
| Очередь матчмейкинга | In-memory → Redis | Просто на старте, легко мигрировать |
| Федерация | Отложить до Фазы 4 | Сначала один глобальный сервер |

## Приоритет платформ (Flutter)

1. Web — быстрый выход без апп-сторов
2. Windows — основная аудитория
3. Android / iOS — после стабилизации
